{% extends 'base.html' %}

{% block title %}Транслит - Внутренний девелопмент{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="bi bi-translate"></i> Транслит для URL (ЧПУ)</h1>
            <a href="{% url 'tools:analysis_list' %}" class="btn btn-outline-light">
                <i class="bi bi-arrow-left"></i> Назад к анализам
            </a>
        </div>
    </div>
</div>

<!-- Статистика -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card stats-card">
            <div class="card-body text-center">
                <h3 class="text-primary">{{ stats.total_results }}</h3>
                <p class="mb-0">Всего транслитов</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stats-card">
            <div class="card-body text-center">
                <h3 class="text-success">{{ stats.url_results }}</h3>
                <p class="mb-0">URL-адреса</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stats-card">
            <div class="card-body text-center">
                <h3 class="text-info">{{ stats.text_results }}</h3>
                <p class="mb-0">Тексты</p>
            </div>
        </div>
    </div>
</div>

<!-- Фильтры и поиск -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card stats-card">
            <div class="card-body">
                <form method="GET" class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label for="search" class="form-label">Поиск</label>
                        <input type="text" class="form-control" id="search" name="search" value="{{ request.GET.search }}" placeholder="Поиск по тексту...">
                    </div>
                    <div class="col-md-3">
                        <label for="is_url" class="form-label">Тип</label>
                        <select class="form-select" id="is_url" name="is_url">
                            <option value="">Все</option>
                            <option value="true" {% if request.GET.is_url == "true" %}selected{% endif %}>URL-адреса</option>
                            <option value="false" {% if request.GET.is_url == "false" %}selected{% endif %}>Тексты</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Результаты -->
<div class="row">
    {% for result in results %}
    <div class="col-md-6 mb-3">
        <div class="card samurai-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title mb-0">
                        {% if result.is_url %}
                            <span class="badge bg-success">URL</span>
                        {% else %}
                            <span class="badge bg-info">Текст</span>
                        {% endif %}
                    </h6>
                    <small class="text-muted">{{ result.created_at|date:"d.m.Y H:i" }}</small>
                </div>
                
                <div class="mb-3">
                    <strong>Исходный:</strong>
                    <div class="mt-1 p-2" style="background-color: #000; border: 1px solid #333; border-radius: 0; color: #ccc; font-family: monospace; word-break: break-all;">
                        {{ result.original_text }}
                    </div>
                </div>
                
                <div class="mb-3">
                    <strong>Транслит:</strong>
                    <div class="mt-1 p-2" style="background-color: #000; border: 1px solid #333; border-radius: 0; color: #fff; font-family: monospace; word-break: break-all;">
                        {{ result.translit_text }}
                    </div>
                </div>
                
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-light" onclick="copyToClipboard('{{ result.translit_text|escapejs }}')">
                        <i class="bi bi-copy"></i> Копировать
                    </button>
                    {% if result.is_url %}
                        <a href="{{ result.translit_text }}" target="_blank" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-box-arrow-up-right"></i> Открыть
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="card samurai-card">
            <div class="card-body text-center">
                <i class="bi bi-translate display-1 text-muted"></i>
                <h4 class="mt-3">Нет результатов транслита</h4>
                <p class="text-muted">Начните с создания транслита на главной странице инструментов</p>
                <a href="{% url 'tools:analysis_list' %}" class="btn btn-primary">
                    <i class="bi bi-arrow-left"></i> К инструментам
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Пагинация -->
{% if is_paginated %}
<div class="row mt-4">
    <div class="col-12">
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.is_url %}&is_url={{ request.GET.is_url }}{% endif %}">Первая</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.is_url %}&is_url={{ request.GET.is_url }}{% endif %}">Предыдущая</a>
                    </li>
                {% endif %}
                
                <li class="page-item active">
                    <span class="page-link">{{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
                </li>
                
                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.is_url %}&is_url={{ request.GET.is_url }}{% endif %}">Следующая</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.is_url %}&is_url={{ request.GET.is_url }}{% endif %}">Последняя</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>
{% endif %}

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Показываем уведомление
        const toast = document.createElement('div');
        toast.className = 'toast-notification';
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 9999;
            font-family: monospace;
        `;
        toast.textContent = 'Скопировано в буфер обмена!';
        document.body.appendChild(toast);
        
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 2000);
    });
}
</script>
{% endblock %}
